---
import Base from "../../layouts/Base.astro";
import { getDb } from "../../lib/db.js";
import { getApprovedMessageById } from "../../data/queries.js";

const { id } = Astro.params;

if (!id) {
  return new Response(null, { status: 404 });
}

const db = getDb();
const message = await getApprovedMessageById(db, id);

if (!message) {
  return new Response(null, { status: 404 });
}

const displayDate = message.approvedAt
  ? message.approvedAt.toLocaleDateString("en-US", {
      year: "numeric",
      month: "short",
      day: "numeric",
    })
  : "";

Astro.response.headers.set(
  "Cache-Control",
  "public, max-age=300, s-maxage=3600, stale-while-revalidate=86400",
);
---

<Base title="Message">
  <nav class="back">
    <a href="/">&larr; All messages</a>
  </nav>

  <article class="message-detail">
    <p class="message-content">{message.content}</p>
    <footer class="message-meta">
      {displayDate && <time>Approved {displayDate}</time>}
    </footer>
  </article>
</Base>

<style>
  .back {
    margin-bottom: 1.5rem;
    font-size: 0.875rem;
  }

  .message-detail {
    padding: 1.5rem;
    border: 1px solid #e5e7eb;
    border-radius: 0.5rem;
    background: #fff;
  }

  .message-content {
    margin-bottom: 1rem;
    white-space: pre-wrap;
    word-break: break-word;
    font-size: 1.125rem;
  }

  .message-meta {
    font-size: 0.875rem;
    color: #6b7280;
  }
</style>
